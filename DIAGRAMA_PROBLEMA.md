# ğŸ¨ Diagrama Visual do Problema e SoluÃ§Ã£o

## ğŸ“Š Entendendo o Problema

### CenÃ¡rio ANTES da CorreÃ§Ã£o (âŒ PROBLEMA)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         INTERNET                                 â”‚
â”‚                    (UsuÃ¡rios tentando acessar)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  EASYPANEL - PROXY REVERSO                       â”‚
â”‚                        (Traefik)                                 â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“¨ Recebe requisiÃ§Ãµes HTTPS                                     â”‚
â”‚  ğŸ”„ Encaminha para: http://agenciaia_ag:80                       â”‚
â”‚                                                                  â”‚
â”‚  DomÃ­nios configurados:                                          â”‚
â”‚  â€¢ https://producoes.agmusic.cloud/ â†’ :80                        â”‚
â”‚  â€¢ https://agenciaia-ag.plam7g.easypanel.host/ â†’ :80            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Tenta conectar na PORTA 80
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CONTAINER DOCKER (agenciaia_ag)                     â”‚
â”‚                                                                  â”‚
â”‚  VariÃ¡veis de Ambiente:                                          â”‚
â”‚  â€¢ PORT=3000 âŒ                                                  â”‚
â”‚  â€¢ DATABASE_URL=...                                              â”‚
â”‚  â€¢ NEXTAUTH_URL=...                                              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚          AplicaÃ§Ã£o Next.js                             â”‚     â”‚
â”‚  â”‚                                                         â”‚     â”‚
â”‚  â”‚  ğŸ¯ Escutando na PORTA 3000                            â”‚     â”‚
â”‚  â”‚  âœ… http://localhost:3000 (OK)                         â”‚     â”‚
â”‚  â”‚  âŒ http://localhost:80 (NADA ESCUTANDO)               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚  âŒ PROBLEMA:                                                    â”‚
â”‚     Proxy tenta conectar na :80                                 â”‚
â”‚     Next.js estÃ¡ escutando na :3000                             â”‚
â”‚     = CONEXÃƒO FALHA!                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   HEALTH CHECK DO EASYPANEL                      â”‚
â”‚                                                                  â”‚
â”‚  ğŸ” Verifica: http://agenciaia_ag:80/                           â”‚
â”‚  âŒ Resposta: Timeout / Connection Refused                       â”‚
â”‚  ğŸ“Š Status: UNHEALTHY                                            â”‚
â”‚                                                                  â”‚
â”‚  AÃ§Ã£o tomada:                                                    â”‚
â”‚  ğŸ”´ Envia SIGTERM para o container                               â”‚
â”‚  ğŸ”„ Reinicia o container                                         â”‚
â”‚                                                                  â”‚
â”‚  âš ï¸ CICLO INFINITO DE REINICIALIZAÃ‡Ã•ES!                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### CenÃ¡rio DEPOIS da CorreÃ§Ã£o (âœ… FUNCIONANDO)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         INTERNET                                 â”‚
â”‚                    (UsuÃ¡rios acessando)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  EASYPANEL - PROXY REVERSO                       â”‚
â”‚                        (Traefik)                                 â”‚
â”‚                                                                  â”‚
â”‚  ğŸ“¨ Recebe requisiÃ§Ãµes HTTPS                                     â”‚
â”‚  ğŸ”„ Encaminha para: http://agenciaia_ag:80                       â”‚
â”‚                                                                  â”‚
â”‚  DomÃ­nios configurados:                                          â”‚
â”‚  â€¢ https://producoes.agmusic.cloud/ â†’ :80 âœ…                    â”‚
â”‚  â€¢ https://agenciaia-ag.plam7g.easypanel.host/ â†’ :80 âœ…         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Conecta na PORTA 80 âœ…
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CONTAINER DOCKER (agenciaia_ag)                     â”‚
â”‚                                                                  â”‚
â”‚  VariÃ¡veis de Ambiente:                                          â”‚
â”‚  â€¢ PORT=80 âœ… (CORRIGIDO!)                                      â”‚
â”‚  â€¢ DATABASE_URL=...                                              â”‚
â”‚  â€¢ NEXTAUTH_URL=...                                              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚          AplicaÃ§Ã£o Next.js                             â”‚     â”‚
â”‚  â”‚                                                         â”‚     â”‚
â”‚  â”‚  ğŸ¯ Escutando na PORTA 80 âœ…                           â”‚     â”‚
â”‚  â”‚  âœ… http://localhost:80 (FUNCIONANDO!)                 â”‚     â”‚
â”‚  â”‚  ğŸ“ - Local: http://localhost:80                       â”‚     â”‚
â”‚  â”‚  ğŸ“ - Network: http://0.0.0.0:80                       â”‚     â”‚
â”‚  â”‚  âœ“ Ready in 2500ms                                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                  â”‚
â”‚  âœ… SUCESSO:                                                     â”‚
â”‚     Proxy conecta na :80                                        â”‚
â”‚     Next.js estÃ¡ escutando na :80                               â”‚
â”‚     = CONEXÃƒO ESTABELECIDA! ğŸ‰                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   HEALTH CHECK DO EASYPANEL                      â”‚
â”‚                                                                  â”‚
â”‚  ğŸ” Verifica: http://agenciaia_ag:80/                           â”‚
â”‚  âœ… Resposta: 200 OK                                             â”‚
â”‚  ğŸ“Š Status: HEALTHY âœ…                                           â”‚
â”‚                                                                  â”‚
â”‚  AÃ§Ã£o tomada:                                                    â”‚
â”‚  ğŸŸ¢ Container marcado como saudÃ¡vel                              â”‚
â”‚  âœ¨ Nenhuma reinicializaÃ§Ã£o necessÃ¡ria                           â”‚
â”‚                                                                  â”‚
â”‚  ğŸ‰ APLICAÃ‡ÃƒO ESTÃVEL E FUNCIONANDO!                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Fluxo de RequisiÃ§Ã£o Comparado

### âŒ ANTES (Falhando)

```
1. UsuÃ¡rio
   â†“
2. DNS resolve para Easypanel
   â†“
3. HTTPS â†’ Proxy Easypanel
   â†“
4. Proxy tenta: http://agenciaia_ag:80
   â†“
5. Container porta :80 â†’ âŒ VAZIO
   â”‚
   â””â†’ Porta :3000 â†’ âœ… Next.js estÃ¡ aqui
   â†“
6. Timeout / Connection Refused
   â†“
7. Health Check FALHA
   â†“
8. SIGTERM enviado
   â†“
9. Container reinicia
   â†“
10. VOLTA PARA O PASSO 1 (ciclo infinito) ğŸ”„
```

### âœ… DEPOIS (Funcionando)

```
1. UsuÃ¡rio
   â†“
2. DNS resolve para Easypanel
   â†“
3. HTTPS â†’ Proxy Easypanel
   â†“
4. Proxy conecta: http://agenciaia_ag:80
   â†“
5. Container porta :80 â†’ âœ… Next.js escutando aqui!
   â†“
6. RequisiÃ§Ã£o processada
   â†“
7. Resposta enviada ao usuÃ¡rio
   â†“
8. Health Check SUCESSO âœ…
   â†“
9. Container permanece rodando
   â†“
10. Tudo funcionando normalmente! ğŸ‰
```

---

## ğŸ“¦ Anatomia do Container

### Estrutura do Container

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONTAINER DOCKER                            â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Sistema Operacional (Linux)                         â”‚     â”‚
â”‚  â”‚                                                       â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚
â”‚  â”‚  â”‚  Node.js Runtime                             â”‚     â”‚     â”‚
â”‚  â”‚  â”‚                                              â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â”‚  AplicaÃ§Ã£o Next.js                 â”‚     â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â”‚                                     â”‚     â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â”‚  LÃª variÃ¡vel: process.env.PORT     â”‚     â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â”‚                                     â”‚     â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â”‚  âŒ ANTES: PORT=3000               â”‚     â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â”‚  app.listen(3000)                  â”‚     â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â”‚                                     â”‚     â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â”‚  âœ… DEPOIS: PORT=80                â”‚     â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â”‚  app.listen(80)                    â”‚     â”‚     â”‚     â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                â”‚
â”‚  Portas Expostas:                                              â”‚
â”‚  â€¢ 3000 âŒ (antes - errado)                                   â”‚
â”‚  â€¢ 80   âœ… (depois - correto)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” AnÃ¡lise Detalhada do Problema

### Timeline do Problema

```
T = 0s
â”œâ”€ Container inicia
â”œâ”€ Next.js lÃª PORT=3000
â”œâ”€ AplicaÃ§Ã£o escuta em localhost:3000
â””â”€ âœ… AplicaÃ§Ã£o iniciou com sucesso

T = 5s
â”œâ”€ Easypanel faz primeiro health check
â”œâ”€ Tenta conectar em agenciaia_ag:80
â”œâ”€ âŒ ConexÃ£o recusada (nada na porta 80)
â””â”€ âš ï¸ Health check falha (1/3)

T = 35s
â”œâ”€ Easypanel faz segundo health check
â”œâ”€ Tenta conectar em agenciaia_ag:80
â”œâ”€ âŒ ConexÃ£o recusada
â””â”€ âš ï¸ Health check falha (2/3)

T = 65s
â”œâ”€ Easypanel faz terceiro health check
â”œâ”€ Tenta conectar em agenciaia_ag:80
â”œâ”€ âŒ ConexÃ£o recusada
â”œâ”€ âš ï¸ Health check falha (3/3)
â””â”€ ğŸ”´ Container marcado como UNHEALTHY

T = 70s
â”œâ”€ Easypanel decide reiniciar o container
â”œâ”€ Envia SIGTERM para o processo
â”œâ”€ Next.js recebe o sinal
â”œâ”€ "SIGTERM received"
â”œâ”€ "Gracefully shutting down. Please wait..."
â””â”€ "Shutdown complete"

T = 75s
â”œâ”€ Container para completamente
â””â”€ Easypanel agenda restart

T = 80s
â””â”€ VOLTA PARA T=0 (ciclo se repete) ğŸ”„
```

---

## ğŸ¯ ComparaÃ§Ã£o Visual das SoluÃ§Ãµes

### SoluÃ§Ã£o Principal: Mudar PORT para 80

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONFIGURAÃ‡ÃƒO                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  VariÃ¡vel de Ambiente:                                       â”‚
â”‚  PORT=80 âœ…                                                  â”‚
â”‚                                                              â”‚
â”‚  Proxy Reverso:                                              â”‚
â”‚  â†’ http://agenciaia_ag:80 âœ…                                 â”‚
â”‚                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  RESULTADO                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  âœ… Porta 80 â†”ï¸ Porta 80 = MATCH!                           â”‚
â”‚  âœ… ConfiguraÃ§Ã£o mais simples                                â”‚
â”‚  âœ… Apenas 1 mudanÃ§a necessÃ¡ria                              â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Alternativa 1: Manter PORT 3000

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONFIGURAÃ‡ÃƒO                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  VariÃ¡vel de Ambiente:                                       â”‚
â”‚  (Removida ou PORT=3000) âœ…                                  â”‚
â”‚                                                              â”‚
â”‚  Proxy Reverso:                                              â”‚
â”‚  â†’ http://agenciaia_ag:3000 âœ… (ALTERADO)                    â”‚
â”‚                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  RESULTADO                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  âœ… Porta 3000 â†”ï¸ Porta 3000 = MATCH!                       â”‚
â”‚  ğŸŸ¨ Requer alterar TODOS os domÃ­nios                         â”‚
â”‚  ğŸŸ¨ Mais passos necessÃ¡rios                                  â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Impacto da CorreÃ§Ã£o

### MÃ©tricas Esperadas

```
ANTES DA CORREÃ‡ÃƒO:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Uptime:        â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘  30%         â”‚
â”‚  Disponibilidade: Intermitente          â”‚
â”‚  ReinicializaÃ§Ãµes: 10-20 por hora       â”‚
â”‚  SIGTERM: âœ… Frequente                  â”‚
â”‚  UsuÃ¡rios afetados: 100%                â”‚
â”‚  Status: ğŸ”´ CRÃTICO                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

DEPOIS DA CORREÃ‡ÃƒO:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Uptime:        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  100%        â”‚
â”‚  Disponibilidade: Constante             â”‚
â”‚  ReinicializaÃ§Ãµes: 0 (apenas deploys)   â”‚
â”‚  SIGTERM: âŒ Nenhum                     â”‚
â”‚  UsuÃ¡rios afetados: 0%                  â”‚
â”‚  Status: ğŸŸ¢ SAUDÃVEL                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª Teste de ValidaÃ§Ã£o

### Como Testar se EstÃ¡ Funcionando

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TESTE 1: Verificar Logs                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  Procure por:                                             â”‚
â”‚  âœ… "- Local: http://localhost:80"                       â”‚
â”‚  âœ… "âœ“ Ready in XXXXms"                                  â”‚
â”‚                                                           â”‚
â”‚  NÃƒO deve ter:                                            â”‚
â”‚  âŒ "SIGTERM received"                                    â”‚
â”‚  âŒ "Gracefully shutting down"                            â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TESTE 2: Acessar Site                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  URL: https://producoes.agmusic.cloud/                   â”‚
â”‚                                                           â”‚
â”‚  Resultado esperado:                                      â”‚
â”‚  âœ… Carrega em < 3 segundos                              â”‚
â”‚  âœ… Status 200 OK                                         â”‚
â”‚  âœ… ConteÃºdo exibido corretamente                         â”‚
â”‚  âœ… Sem mensagens de erro                                 â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TESTE 3: Monitorar por 30 Minutos                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  VerificaÃ§Ãµes:                                            â”‚
â”‚  âœ… Container permanece "Running"                         â”‚
â”‚  âœ… Nenhum reinÃ­cio inesperado                            â”‚
â”‚  âœ… MÃ©tricas estÃ¡veis (CPU, RAM)                          â”‚
â”‚  âœ… Site acessÃ­vel durante todo o perÃ­odo                 â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ LiÃ§Ãµes Aprendidas

### Por Que Isso Aconteceu?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CAUSA 1: ConfiguraÃ§Ã£o Manual                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ VariÃ¡vel PORT foi configurada manualmente               â”‚
â”‚  â€¢ Valor nÃ£o correspondia ao proxy reverso                  â”‚
â”‚  â€¢ Falta de documentaÃ§Ã£o sobre requisitos de porta         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CAUSA 2: Health Check PadrÃ£o                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Easypanel usa health check automÃ¡tico                    â”‚
â”‚  â€¢ Verifica a porta configurada no proxy (80)               â”‚
â”‚  â€¢ NÃ£o foi ajustado para a porta real da aplicaÃ§Ã£o (3000)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CAUSA 3: Comportamento do Next.js                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Next.js respeita a variÃ¡vel PORT do ambiente             â”‚
â”‚  â€¢ Se PORT=3000, escuta APENAS na porta 3000                â”‚
â”‚  â€¢ NÃ£o escuta em mÃºltiplas portas automaticamente           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Como Prevenir no Futuro?

```
âœ… PREVENÃ‡ÃƒO 1: DocumentaÃ§Ã£o
   â€¢ Adicionar README com configuraÃ§Ãµes necessÃ¡rias
   â€¢ Especificar requisito de PORT=80 para Easypanel
   â€¢ Incluir screenshots das configuraÃ§Ãµes corretas

âœ… PREVENÃ‡ÃƒO 2: ValidaÃ§Ã£o
   â€¢ Adicionar health check endpoint na aplicaÃ§Ã£o
   â€¢ Logar a porta em que a aplicaÃ§Ã£o estÃ¡ escutando
   â€¢ Adicionar testes de integraÃ§Ã£o

âœ… PREVENÃ‡ÃƒO 3: AutomaÃ§Ã£o
   â€¢ Usar Docker Compose com configuraÃ§Ã£o correta
   â€¢ Criar script de validaÃ§Ã£o prÃ©-deployment
   â€¢ Configurar alertas para reinicializaÃ§Ãµes frequentes

âœ… PREVENÃ‡ÃƒO 4: Monitoramento
   â€¢ Configurar alertas para SIGTERM
   â€¢ Monitorar uptime da aplicaÃ§Ã£o
   â€¢ Dashboard de health checks
```

---

## ğŸ¬ Resumo Visual Final

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    PROBLEMA â†’ SOLUÃ‡ÃƒO                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                â•‘
â•‘  ANTES:                                                        â•‘
â•‘  â€¢ Proxy â†’ :80                                                 â•‘
â•‘  â€¢ Next.js â†’ :3000                                             â•‘
â•‘  â€¢ âŒ INCOMPATÃVEL â†’ SIGTERM Loop                             â•‘
â•‘                                                                â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â•‘
â•‘                                                                â•‘
â•‘  CORREÃ‡ÃƒO:                                                     â•‘
â•‘  â€¢ Mudar PORT=3000 para PORT=80                                â•‘
â•‘                                                                â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â•‘
â•‘                                                                â•‘
â•‘  DEPOIS:                                                       â•‘
â•‘  â€¢ Proxy â†’ :80                                                 â•‘
â•‘  â€¢ Next.js â†’ :80                                               â•‘
â•‘  â€¢ âœ… COMPATÃVEL â†’ AplicaÃ§Ã£o EstÃ¡vel                          â•‘
â•‘                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

*Diagrama criado em: 27 de outubro de 2025*  
*VersÃ£o: 1.0*  
*CompatÃ­vel com: Easypanel, Next.js 15.0.3, Docker*
