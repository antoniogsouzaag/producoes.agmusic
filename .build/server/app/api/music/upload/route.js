"use strict";(()=>{var e={};e.id=411,e.ids=[411],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},2048:e=>{e.exports=require("fs")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},4499:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{POST:()=>d,dynamic:()=>p});var i=r(9303),o=r(8716),s=r(670),n=r(7070),u=r(2663),c=r(6497);let p="force-dynamic";async function d(e){try{let t=await e.formData(),r=t.get("file"),a=t.get("coverImage"),i=t.get("title"),o=t.get("artist")||"Ant\xf4nio Garcia";if(!r)return n.NextResponse.json({error:"Nenhum arquivo foi enviado"},{status:400});if(!r.type.startsWith("audio/"))return n.NextResponse.json({error:"O arquivo deve ser um \xe1udio"},{status:400});let s=Buffer.from(await r.arrayBuffer()),p=await (0,c.cT)(s,r.name,r.type),d=null;if(a&&a.type.startsWith("image/")){let e=Buffer.from(await a.arrayBuffer());d=await (0,c.cT)(e,a.name,a.type)}let l=await u._.music.create({data:{title:i,artist:o,cloud_storage_path:p,cover_image_path:d}});return n.NextResponse.json({success:!0,music:{id:l.id,title:l.title,artist:l.artist}})}catch(e){return console.error("Upload error:",e),n.NextResponse.json({error:"Erro ao fazer upload da m\xfasica"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/music/upload/route",pathname:"/api/music/upload",filename:"route",bundlePath:"app/api/music/upload/route"},resolvedPagePath:"/home/ubuntu/code_artifacts/producoes.agmusic/app/api/music/upload/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:y}=l,w="/api/music/upload/route";function x(){return(0,s.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}},2663:(e,t,r)=>{r.d(t,{_:()=>i});let a=require("@prisma/client"),i=globalThis.prisma??new a.PrismaClient},6497:(e,t,r)=>{r.d(t,{_I:()=>p,qm:()=>c,cT:()=>u});let a=require("@aws-sdk/client-s3");var i=r(9710);let o=new a.S3Client({}),{bucketName:s,folderPrefix:n}={bucketName:process.env.AWS_BUCKET_NAME,folderPrefix:process.env.AWS_FOLDER_PREFIX||""};async function u(e,t,r="audio/mpeg"){let i=`${n}music/${Date.now()}-${t}`;return await o.send(new a.PutObjectCommand({Bucket:s,Key:i,Body:e,ContentType:r})),i}async function c(e,t=3600){let r=new a.GetObjectCommand({Bucket:s,Key:e});return await (0,i.e)(o,r,{expiresIn:t})}async function p(e){await o.send(new a.DeleteObjectCommand({Bucket:s,Key:e}))}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,97],()=>r(4499));module.exports=a})();